-- MySQL dump 10.13  Distrib 8.0.32, for Win64 (x86_64)
--
-- Host: cosc3380mysql.mysql.database.azure.com    Database: library
-- ------------------------------------------------------
-- Server version	5.7.40-log

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `checkout`
--

DROP TABLE IF EXISTS `checkout`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `checkout` (
  `CheckoutID` int(11) NOT NULL AUTO_INCREMENT,
  `MemberID` int(11) NOT NULL,
  `CopyID` int(11) NOT NULL,
  `StartDate` datetime NOT NULL,
  `EndDate` datetime NOT NULL,
  `ReturnDate` datetime DEFAULT NULL,
  `TotalLateFee` float DEFAULT '0',
  `Status` tinyint(1) NOT NULL DEFAULT '0',
  `PayFlag` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`CheckoutID`),
  KEY `FK_MemberID_Checkout` (`MemberID`),
  KEY `FK_CopyID_Checkout` (`CopyID`),
  CONSTRAINT `FK_CopyID_Checkout` FOREIGN KEY (`CopyID`) REFERENCES `copy` (`CopyID`),
  CONSTRAINT `FK_MemberID_Checkout` FOREIGN KEY (`MemberID`) REFERENCES `member` (`MemberID`)
) ENGINE=InnoDB AUTO_INCREMENT=155 DEFAULT CHARSET=utf8mb4;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `checkout`
--

LOCK TABLES `checkout` WRITE;
/*!40000 ALTER TABLE `checkout` DISABLE KEYS */;
INSERT INTO `checkout` VALUES (12,11,8,'2023-03-17 14:31:39','2023-03-20 23:59:59','2023-03-19 12:42:14',0,2,NULL),(13,11,3,'2023-03-17 15:15:23','2023-03-20 23:59:59','2023-03-19 12:42:14',0,2,NULL),(14,11,3,'2023-03-17 15:16:31','2023-03-20 23:59:59','2023-03-19 12:42:14',0,2,NULL),(15,11,4,'2023-03-17 16:10:48','2023-03-20 23:59:59','2023-03-19 12:42:00',0,2,NULL),(16,11,1,'2023-03-19 12:26:42','2023-03-22 23:59:59','2023-03-19 12:42:16',0,2,NULL),(19,11,4,'2023-03-19 13:16:15','2023-03-22 23:59:59','2023-03-19 12:42:14',0,2,NULL),(20,16,4,'2023-03-19 00:00:00','2023-03-22 00:00:00','2023-03-19 12:42:14',0,2,NULL),(21,16,1,'2023-03-19 13:26:18','2023-03-22 23:59:59','2023-03-19 12:42:14',0,2,NULL),(22,11,1,'2023-03-19 00:00:00','2023-03-22 00:00:00','2023-03-20 13:27:26',0,2,NULL),(23,11,3,'2023-03-19 13:32:41','2023-03-22 23:59:59','2023-03-19 15:51:35',0,2,NULL),(24,11,4,'2023-03-19 13:33:33','2023-03-22 23:59:59','2023-03-19 12:42:14',0,2,NULL),(26,11,3,'2023-03-19 15:04:33','2023-03-22 23:59:59','2023-03-19 15:52:20',0,2,NULL),(28,11,7,'2023-03-19 15:50:49','2023-03-22 23:59:59','2023-03-25 15:51:48',3.75,2,1),(29,11,6,'2023-03-19 15:51:15','2023-03-22 23:59:59','2023-03-19 15:52:27',0,2,NULL),(30,11,3,'2023-03-19 20:18:24','2023-03-22 23:59:59','2023-03-20 01:20:47',0,2,NULL),(31,11,4,'2023-03-19 20:19:57','2023-03-22 23:59:59','2023-03-20 01:20:22',0,2,NULL),(32,11,1,'2023-03-19 20:21:33','2023-03-22 23:59:59','2023-03-29 06:04:02',8.75,2,1),(33,11,3,'2023-03-20 19:47:45','2023-03-23 23:59:59','2023-03-21 00:49:15',0,2,NULL),(34,11,3,'2023-03-20 21:32:13','2023-03-23 23:59:59','2023-03-21 03:16:19',0,2,NULL),(35,11,4,'2023-03-20 22:06:29','2023-03-23 23:59:59','2023-03-21 03:16:27',0,2,NULL),(36,11,1,'2023-03-20 22:07:04','2023-03-23 23:59:59','2023-03-21 03:16:36',0,2,NULL),(37,11,6,'2023-03-20 22:07:27','2023-03-23 23:59:59','2023-03-21 03:16:45',0,2,NULL),(38,11,8,'2023-03-20 22:14:19','2023-03-23 23:59:59','2023-03-21 03:16:57',0,2,NULL),(39,11,3,'2023-03-21 00:00:00','2023-03-24 00:00:00','2023-03-21 03:17:05',0,2,NULL),(40,11,6,'2023-03-20 22:17:37','2023-03-23 23:59:59','2023-03-21 03:17:56',0,2,NULL),(41,11,6,'2023-03-21 00:00:00','2023-03-24 00:00:00','2023-03-28 00:30:30',5,2,1),(43,43,4,'2023-03-25 18:02:29','2023-03-28 23:59:59','2023-03-28 00:31:10',0,2,NULL),(44,43,16,'2023-03-25 18:22:45','2023-03-28 23:59:59','2023-03-28 00:31:12',0,2,NULL),(45,43,17,'2023-03-25 18:24:01','2023-03-28 23:59:59','2023-03-28 00:31:33',0,2,NULL),(46,43,17,'2023-03-25 18:25:23','2023-03-28 23:59:59','2023-03-28 00:31:35',0,2,NULL),(47,43,17,'2023-03-25 18:26:43','2023-03-28 23:59:59','2023-03-28 00:31:37',0,2,NULL),(48,43,1,'2023-03-25 18:26:43','2023-03-28 23:59:59','2023-03-28 00:31:41',0,2,NULL),(49,43,17,'2023-03-25 18:45:23','2023-03-28 23:59:59','2023-03-28 00:31:43',0,2,NULL),(50,43,1,'2023-03-25 18:45:23','2023-03-28 23:59:59','2023-03-28 00:31:45',0,2,NULL),(51,43,5,'2023-03-25 18:45:23','2023-03-28 23:59:59','2023-03-28 00:31:47',0,2,NULL),(52,43,12,'2023-03-25 18:50:26','2023-03-28 23:59:59','2023-03-28 00:31:50',0,2,NULL),(53,19,92,'2023-03-27 13:58:28','2023-03-30 23:59:59','2023-03-28 00:30:58',0,2,NULL),(54,41,46,'2023-03-27 19:28:22','2023-03-30 23:59:59','2023-03-28 00:29:29',0,2,NULL),(55,41,46,'2023-03-28 00:00:00','2023-03-31 00:00:00','2023-03-28 00:30:44',0,2,NULL),(56,19,46,'2023-03-28 00:00:00','2023-03-31 00:00:00','2023-03-28 00:30:37',0,2,NULL),(57,11,3,'2023-03-28 00:00:00','2023-03-31 00:00:00','2023-03-28 00:31:08',0,2,NULL),(58,16,3,'2023-03-28 00:00:00','2023-03-31 00:00:00','2023-03-28 00:31:30',0,2,NULL),(59,43,3,'2023-03-28 00:00:00','2023-03-31 00:00:00','2023-03-28 00:31:57',0,2,NULL),(60,41,92,'2023-03-27 19:32:19','2023-03-30 23:59:59','2023-03-28 00:32:54',0,2,NULL),(61,19,92,'2023-03-28 00:00:00','2023-03-31 00:00:00','2023-03-28 00:33:31',0,2,NULL),(62,41,92,'2023-03-28 00:00:00','2023-03-31 00:00:00','2023-03-28 00:34:06',0,2,NULL),(63,11,62,'2023-03-29 12:08:15','2023-04-01 23:59:59','2023-03-29 17:10:36',0,2,NULL),(64,11,85,'2023-03-29 12:08:23','2023-04-01 23:59:59','2023-03-29 17:10:40',0,2,NULL),(65,11,6,'2023-03-29 12:08:30','2023-04-01 23:59:59','2023-03-29 17:10:44',0,2,NULL),(66,11,7,'2023-03-29 12:08:50','2023-04-01 23:59:59','2023-03-30 14:09:57',0,2,NULL),(67,11,46,'2023-03-29 12:09:06','2023-04-01 23:59:59','2023-03-30 14:09:46',0,2,NULL),(68,11,69,'2023-03-29 12:09:13','2023-04-01 23:59:59','2023-03-30 14:09:51',0,2,NULL),(69,11,85,'2023-03-29 12:39:19','2023-04-01 23:59:59','2023-03-30 14:14:55',0,2,NULL),(70,11,92,'2023-03-30 09:17:22','2023-04-02 23:59:59','2023-03-30 14:29:41',0,2,NULL),(71,11,10,'2023-03-30 10:28:58','2023-04-02 23:59:59','2023-03-30 15:29:18',0,2,NULL),(72,42,3,'2023-03-30 20:14:30','2023-04-02 23:59:59','2023-03-31 02:39:50',0,2,NULL),(73,42,85,'2023-03-30 20:14:30','2023-04-02 23:59:59','2023-03-31 03:11:29',0,2,NULL),(74,42,62,'2023-03-30 20:15:38','2023-04-02 23:59:59','2023-03-31 02:12:58',0,2,NULL),(75,42,62,'2023-03-30 21:14:13','2023-04-02 23:59:59','2023-03-31 02:39:41',0,2,NULL),(76,42,62,'2023-03-30 21:24:29','2023-04-02 23:59:59','2023-03-31 02:40:05',0,2,NULL),(77,42,27,'2023-03-30 21:24:29','2023-04-02 23:59:59','2023-03-31 02:40:10',0,2,NULL),(78,42,30,'2023-03-30 21:29:49','2023-04-02 23:59:59','2023-03-31 02:40:16',0,2,NULL),(79,42,64,'2023-03-30 21:29:49','2023-04-02 23:59:59','2023-03-31 02:59:01',0,2,NULL),(80,42,62,'2023-03-30 21:41:00','2023-04-02 23:59:59','2023-03-31 02:59:07',0,2,NULL),(81,42,37,'2023-03-30 21:41:00','2023-04-02 23:59:59','2023-03-31 02:59:19',0,2,NULL),(82,42,92,'2023-03-30 21:46:01','2023-04-02 23:59:59','2023-03-31 02:59:25',0,2,NULL),(83,42,94,'2023-03-30 21:47:20','2023-04-02 23:59:59','2023-03-31 02:59:33',0,2,NULL),(84,42,92,'2023-03-30 22:11:03','2023-04-02 23:59:59','2023-03-31 23:01:30',0,2,NULL),(85,42,94,'2023-03-30 22:12:02','2023-04-02 23:59:59','2023-03-31 03:23:30',0,2,NULL),(86,42,92,'2023-03-30 22:19:06','2023-04-02 23:59:59','2023-03-31 21:14:36',0,2,NULL),(87,11,85,'2023-03-31 05:23:03','2023-04-03 23:59:59','2023-03-31 23:00:56',0,2,NULL),(88,11,41,'2023-03-31 16:27:17','2023-04-03 23:59:59','2023-03-31 23:00:58',0,2,NULL),(89,11,46,'2023-03-31 16:27:17','2023-04-03 23:59:59','2023-03-31 23:01:02',0,2,NULL),(90,11,79,'2023-03-31 16:27:17','2023-04-03 23:59:59','2023-03-31 23:01:08',0,2,NULL),(91,42,92,'2023-03-31 16:57:29','2023-04-03 23:59:59','2023-03-31 23:01:15',0,2,NULL),(92,42,1,'2023-03-31 16:57:29','2023-04-03 23:59:59','2023-04-04 23:39:40',1.25,2,NULL),(93,42,37,'2023-03-31 16:58:32','2023-04-01 23:59:59','2023-04-04 23:47:18',3.75,2,NULL),(94,11,6,'2023-03-31 17:47:45','2023-04-03 23:59:59','2023-04-01 01:26:08',0,2,NULL),(95,11,62,'2023-03-31 17:47:45','2023-04-03 23:59:59','2023-04-01 01:26:13',0,2,NULL),(98,11,93,'2023-04-01 16:15:33','2023-04-02 23:59:59','2023-04-04 23:53:42',2.5,2,1),(99,43,94,'2023-04-03 19:11:09','2023-04-06 23:59:59','2023-04-04 23:49:42',0,2,NULL),(100,43,62,'2023-04-03 19:11:09','2023-04-03 23:59:59','2023-04-04 23:54:24',1.25,2,NULL),(101,43,41,'2023-04-01 19:12:15','2023-04-02 23:59:59','2023-04-04 23:50:19',2.5,2,NULL),(102,11,46,'2023-04-04 18:04:43','2023-04-07 23:59:59','2023-04-04 23:49:36',0,2,NULL),(103,11,92,'2023-04-04 00:00:00','2023-04-07 00:00:00','2023-04-09 23:49:26',2.5,2,1),(104,11,93,'2023-04-01 00:00:00','2023-04-02 23:59:59','2023-04-10 23:49:26',10,2,1),(105,42,10,'2023-04-01 19:24:04','2023-04-02 23:59:59','2023-04-05 00:44:59',3.75,2,NULL),(106,11,12,'2023-04-04 19:51:20','2023-04-07 23:59:59','2023-04-05 01:02:27',0,2,NULL),(107,11,92,'2023-04-05 02:53:31','2023-04-08 23:59:59','2023-04-05 01:00:30',0,2,NULL),(108,11,62,'2023-04-04 19:59:58','2023-04-07 23:59:59','2023-04-05 01:02:32',0,2,NULL),(109,43,92,'2023-04-05 00:00:00','2023-04-08 00:00:00','2023-04-05 01:01:59',0,2,NULL),(110,11,92,'2023-04-04 20:02:51','2023-04-07 23:59:59','2023-04-05 01:03:16',0,2,NULL),(111,11,79,'2023-04-04 20:04:39','2023-04-07 23:59:59','2023-04-05 16:16:09',0,2,NULL),(112,19,92,'2023-04-04 21:01:29','2023-04-07 23:59:59','2023-04-05 16:16:09',0,2,NULL),(113,19,93,'2023-04-05 11:13:27','2023-04-08 23:59:59','2023-04-05 16:16:09',0,2,NULL),(114,19,94,'2023-04-05 11:13:55','2023-04-08 23:59:59','2023-04-05 16:16:09',0,2,NULL),(115,11,41,'2023-04-05 11:24:50','2023-04-08 23:59:59','2023-04-05 16:16:09',0,2,NULL),(116,11,46,'2023-04-05 11:26:50','2023-04-08 23:59:59','2023-04-05 16:28:19',0,2,NULL),(117,11,90,'2023-04-05 11:29:35','2023-04-08 23:59:59','2023-04-05 16:30:34',0,2,NULL),(118,11,90,'2023-04-05 00:00:00','2023-04-08 00:00:00','2023-04-05 16:31:19',0,2,NULL),(119,11,10,'2023-04-05 11:57:46','2023-04-08 23:59:59','2023-04-06 02:55:06',0,2,NULL),(120,11,85,'2023-04-05 11:57:46','2023-04-08 23:59:59','2023-04-05 16:58:56',0,2,NULL),(121,11,46,'2023-04-05 11:59:16','2023-04-08 23:59:59','2023-04-06 02:43:10',0,2,NULL),(122,44,62,'2023-04-05 13:17:49','2023-04-08 23:59:59','2023-04-06 15:38:33',0,2,NULL),(123,11,63,'2023-04-05 21:43:28','2023-04-08 23:59:59','2023-04-06 02:44:25',0,2,NULL),(124,11,6,'2023-04-05 21:45:00','2023-04-08 23:59:59','2023-04-06 02:52:18',0,2,NULL),(125,11,46,'2023-04-05 21:52:34','2023-04-08 23:59:59','2023-04-06 02:55:02',0,2,NULL),(126,11,85,'2023-04-05 21:55:26','2023-04-08 23:59:59','2023-04-06 03:00:52',0,2,NULL),(127,11,8,'2023-04-05 22:01:08','2023-04-08 23:59:59','2023-04-06 15:29:54',0,2,NULL),(128,11,10,'2023-04-06 00:29:11','2023-04-09 23:59:59','2023-04-06 15:30:59',0,2,NULL),(129,11,62,'2023-04-06 11:33:29','2023-04-09 23:59:59','2023-04-19 20:20:20',12.5,2,1),(130,11,73,'2023-04-06 11:35:13','2023-04-09 23:59:59','2023-04-19 20:19:28',12.5,2,1),(131,11,6,'2023-04-06 11:35:13','2023-04-09 23:59:59','2023-04-17 23:12:42',10,2,1),(132,45,63,'2023-04-08 01:53:52','2023-04-11 23:59:59','2023-04-17 21:47:18',7.5,2,NULL),(141,11,63,'2023-04-17 18:38:00','2023-04-20 23:59:59','2023-04-18 02:02:19',0,2,NULL),(142,19,64,'2023-04-17 18:43:19','2023-04-20 23:59:59','2023-04-18 02:26:20',0,2,NULL),(143,10,110,'2023-04-17 21:03:53','2023-04-20 23:59:59','2023-04-18 02:04:27',0,2,NULL),(144,11,110,'2023-04-18 00:00:00','2023-04-21 00:00:00','2023-04-18 02:18:07',0,2,NULL),(145,48,110,'2023-04-19 08:25:49','2023-04-22 23:59:59','2023-04-19 23:31:09',0,2,NULL),(146,48,64,'2023-04-19 08:31:48','2023-04-22 23:59:59','2023-04-19 23:31:17',0,2,NULL),(147,48,121,'2023-04-19 08:31:48','2023-04-22 23:59:59','2023-04-19 23:31:26',0,2,NULL),(148,11,112,'2023-04-01 00:00:00','2023-04-02 23:59:59','2023-04-19 20:32:25',21.25,2,1),(149,11,85,'2023-03-31 16:57:29','2023-04-02 23:59:59','2023-04-19 20:34:32',21.25,2,1),(150,11,85,'2023-03-20 22:07:27','2023-03-28 23:59:59','2023-04-19 20:37:25',27.5,2,NULL),(151,11,122,'2023-03-28 00:00:00','2023-03-28 23:59:59','2023-04-19 20:38:35',27.5,2,NULL),(152,49,85,'2023-04-19 18:27:05','2023-04-22 23:59:59','2023-04-19 23:31:34',0,2,NULL),(153,49,102,'2023-04-19 18:27:05','2023-04-22 23:59:59','2023-10-19 23:31:39',225,2,NULL),(154,49,11,'2023-04-19 18:32:55','2023-04-22 23:59:59','2023-04-23 15:12:13',1.25,2,NULL);
/*!40000 ALTER TABLE `checkout` ENABLE KEYS */;
UNLOCK TABLES;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`loctrinh`@`%`*/ /*!50003 TRIGGER check_max_items
BEFORE INSERT ON checkout
FOR EACH ROW
BEGIN
  DECLARE max_items INT;
  DECLARE item_count INT;
  SELECT MaxItems INTO max_items FROM membertype WHERE MemberTypeID = (SELECT MemberTypeID FROM member WHERE MemberID = NEW.MemberID);
  SELECT COUNT(*) INTO item_count FROM checkout WHERE MemberID = NEW.MemberID AND Status = 0;
  IF item_count >= max_items THEN
    SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Error: Member has reached the maximum number of items allowed to checkout.';
  END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`loctrinh`@`%`*/ /*!50003 TRIGGER `check_late_fee_limit`
BEFORE INSERT ON `checkout`
FOR EACH ROW
BEGIN
    DECLARE late_fee_total FLOAT;
    SET late_fee_total = (
        SELECT SUM(TotalLateFee)
        FROM checkout
        WHERE MemberID = NEW.MemberID
        AND (PayFlag IS NULL OR PayFlag != 1)
    );
    
    IF late_fee_total + NEW.TotalLateFee > 50 THEN
        SIGNAL SQLSTATE '45000' 
        SET MESSAGE_TEXT = 'Error: Late fee total for member exceeds $50.';
    END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`loctrinh`@`%`*/ /*!50003 TRIGGER update_itemcount
AFTER INSERT ON checkout
FOR EACH ROW
BEGIN
  UPDATE member
  SET ItemCount = ItemCount + 1
  WHERE MemberID = NEW.MemberID;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!50003 SET @saved_cs_client      = @@character_set_client */ ;
/*!50003 SET @saved_cs_results     = @@character_set_results */ ;
/*!50003 SET @saved_col_connection = @@collation_connection */ ;
/*!50003 SET character_set_client  = utf8mb4 */ ;
/*!50003 SET character_set_results = utf8mb4 */ ;
/*!50003 SET collation_connection  = utf8mb4_general_ci */ ;
/*!50003 SET @saved_sql_mode       = @@sql_mode */ ;
/*!50003 SET sql_mode              = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER' */ ;
DELIMITER ;;
/*!50003 CREATE*/ /*!50017 DEFINER=`loctrinh`@`%`*/ /*!50003 TRIGGER `calculate_late_fee` BEFORE UPDATE ON `checkout` FOR EACH ROW 
BEGIN
    DECLARE late_fee DECIMAL(10, 2);
    IF NEW.ReturnDate > OLD.EndDate THEN
        SET late_fee = DATEDIFF(NEW.ReturnDate, OLD.EndDate) * (
            SELECT MAX(LateFee) FROM itemtype WHERE ItemTypeID = (
                SELECT ItemTypeID FROM item WHERE ItemID = (
                    SELECT ItemID FROM copy WHERE CopyID = NEW.CopyID
                )
            )
        );
        SET NEW.TotalLateFee = late_fee;
        INSERT INTO notification (message, created_date, memberID)
        VALUES (CONCAT('You have been charged a late fee of $', late_fee, ' for returning the item "', 
            (SELECT Name FROM item
             JOIN copy ON item.ItemID = copy.ItemID
             WHERE copy.CopyID = NEW.CopyID), 
             '" after the due date.'), NOW(), NEW.MemberID);
    ELSE
        SET NEW.TotalLateFee = 0;
    END IF;
END */;;
DELIMITER ;
/*!50003 SET sql_mode              = @saved_sql_mode */ ;
/*!50003 SET character_set_client  = @saved_cs_client */ ;
/*!50003 SET character_set_results = @saved_cs_results */ ;
/*!50003 SET collation_connection  = @saved_col_connection */ ;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2023-04-23 12:12:34
